services:
  dvr-tuner-nvidia:
    container_name: DirecTV
    build:
      context: .
      dockerfile: Dockerfile.nvidia
    hostname: dvr-tuner-nvidia
    network_mode: bridge
    restart: unless-stopped
    shm_size: '2gb'
    runtime: nvidia
    environment:
      - TZ=America/New_York
      - DISPLAY=:1
      - DVR_NUM_TUNERS=4
      - DVR_PORT=7070
      - DVR_HW_ACCEL=nvenc
      - DVR_AUDIO_DELAY_MS=1500
      - DVR_PROFILE_SYNC_DISABLED=true # Disable auto-sync
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=video,compute,utility
    ports:
      - "7070:7070" # DVR API
      - "6080:6080" # noVNC Tuner 0
      - "6081:6081" # noVNC Tuner 1
      - "6082:6082" # noVNC Tuner 2
      - "6083:6083" # noVNC Tuner 3
    volumes:
      - /mnt/user/appdata/directv/data:/data
